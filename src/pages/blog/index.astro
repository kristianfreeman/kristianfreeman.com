---
import Default from '@/layouts/default.astro';
import { getCollection } from 'astro:content';
import FormattedDate from '@/components/FormattedDate.astro';

let posts = (await getCollection('blog')).sort(
  (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf(),
);

let firstPostYear = posts[0].data.pubDate.getFullYear();

let tags = [...new Set(posts.map((post) => post.data.tags).flat().filter(Boolean))].sort()
---

<Default title="Blog">
  <h1 class="font-bold">
    Blog
  </h1>

  <h2>{posts.length} posts that I've written since {firstPostYear}.</h2>

  <section class="mt-16">
    <div class="flex flex-col gap-12">
      {posts.map((post) => (
        <div class="flex flex-col gap-2">
          <h2 class="leading-6 m-0">
            <a href={`/${post.slug}`}>
              {post.data.title}
            </a>
          </h2>
          <p class="m-0">{post.data.description}</p>
          <p class="m-0 text-foreground/80"><FormattedDate date={post.data.pubDate} /></p>
        </div>
      ))}
    </div>
  </section>

  <section class="mt-12">
    <div class="flex flex-wrap gap-4">
      {tags.map((tag) => (
        <a href={`/tags/${tag}`}>#{tag}</a>
      ))}
    </div>
  </section>
</Default>
